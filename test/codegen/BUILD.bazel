[sh_test(
    name = "codegen_%s" % f[f.rfind("/") + 1:f.rfind(".")],
    srcs = ["codegentester"],
    args = ["$(location %s)" % f],
    data = [
        "//cmd/chi",
        f,
        ":workspace",
    ],
) for f in glob(["workspace/src/*/*.json"])]

cc_binary(
    name = "codegentester",
    srcs = ["codegentester.cpp"],
    deps = [
        "//chi/Core",
    ],
)

filegroup(
    name = "workspace",
    srcs = glob([
        "workspace/src/*/*.chimod",
        "workspace/*",
        "workspace/src/*",
        "workspace/src/*/*/*.c",
        "workspace/src/*/*/*.h",
    ]),
    visibility = [
        "//visibility:public",
    ],
)
